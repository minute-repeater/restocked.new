# Nixpacks configuration for Railway builds
# This file explicitly controls build phases to prevent EBUSY errors
# on node_modules/.cache (which is a mounted cache directory)

[phases.setup]
# npm is bundled with nodejs_20 - do NOT list it separately
nixPkgs = ["nodejs_20"]

[phases.install]
# Let Nixpacks handle npm ci automatically - DO NOT override
# This runs in a clean layer before the cache mount

[phases.build]
# Only compile TypeScript - do NOT run npm ci here
# npm ci would try to delete node_modules/.cache which is mounted
cmds = ["rm -rf dist", "npm run build"]

[start]
# Default start command for API service
# Worker service overrides this with: npm run start:worker
cmd = "npm start"
